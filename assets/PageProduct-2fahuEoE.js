var K=Object.defineProperty;var G=(c,e,d)=>e in c?K(c,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[e]=d;var n=(c,e,d)=>G(c,typeof e!="symbol"?e+"":e,d);import{d as X,e as M,g as U,s as F,c as k,b as o,F as $,i as V,o as f,_ as j,u as J,p as Y,a as Z,w as ee,r as te,t as y,l as ie,q as se,m as O,n as W,v as Q}from"./index-BdbCx6t5.js";import{u as ne}from"./products.store-FyFiBj5m.js";const oe="/game3d/images/left-black.png";class re{constructor(e){n(this,"mediaQueries");n(this,"flagDragDropMouse",!1);n(this,"flagDragDropTouch",!1);n(this,"windowWidth",document.documentElement.clientWidth);n(this,"elemSliderTrack");n(this,"elemItem");n(this,"elemBtnNext",null);n(this,"elemBtnPrev",null);n(this,"totalSteps");n(this,"stepNumber");n(this,"position");n(this,"sliderLength");n(this,"visibleSlides");n(this,"distance");n(this,"onResize");n(this,"onDOMLoaded");n(this,"onclickNext");n(this,"onclickPrev");n(this,"callBackResize",()=>{});n(this,"isDragging",null);n(this,"touchStart",null);n(this,"touchEnd",null);n(this,"touchMove",null);n(this,"ontouchstart");n(this,"ontouchmove");n(this,"ontouchend");n(this,"onmousedown");n(this,"onmousemove");n(this,"onmouseup");this.mediaQueries=e}initSlider({btnNext:e=null,btnPrev:d=null,sliderTrack:E,item:_,itemLength:s}){this.elemItem=_,this.elemBtnNext=e,this.elemBtnPrev=d,this.elemSliderTrack=E,this.stepNumber=1,this.position=0,this.sliderLength=s,this.visibleSlides=this.getVisibleSlidesMediaQueries(this.mediaQueries),this.distance=this.updateWidthItem(),this.setTotalSteps(),this.onResize=this.handleResize.bind(this),this.onDOMLoaded=this.handleDOMLoaded.bind(this),document.addEventListener("DOMContentLoaded",this.onDOMLoaded),window.addEventListener("resize",this.onResize),this.elemBtnNext&&this.elemBtnPrev&&(this.onclickNext=this.handleClickNext.bind(this),this.onclickPrev=this.handleClickPrev.bind(this),this.elemBtnNext.addEventListener("click",this.onclickNext),this.elemBtnPrev.addEventListener("click",this.onclickPrev))}dispatchSlideChangeEvent(){const e=new CustomEvent("slideChanged",{bubbles:!0,detail:{currentStep:this.stepNumber,totalSteps:this.totalSteps}});this.elemSliderTrack.dispatchEvent(e)}initResizeCallback(e){this.callBackResize=e}removeAllListener(){document.removeEventListener("DOMContentLoaded",this.onDOMLoaded),window.removeEventListener("resize",this.onResize),this.elemBtnNext&&this.elemBtnPrev&&(this.elemBtnNext.removeEventListener("click",this.onclickNext),this.elemBtnPrev.removeEventListener("click",this.onclickPrev)),this.flagDragDropMouse&&(this.elemSliderTrack.removeEventListener("mousedown",this.onmousedown),this.elemSliderTrack.removeEventListener("mousemove",this.onmousemove),document.removeEventListener("mouseup",this.onmouseup)),this.flagDragDropTouch&&(this.elemSliderTrack.removeEventListener("touchstart",this.ontouchstart),this.elemSliderTrack.removeEventListener("touchmove",this.ontouchmove),document.removeEventListener("touchend",this.ontouchend))}handleClickNext(){this.moveNext(),this.updateButtonStates(),this.setSlideStep()}handleClickPrev(){this.movePrev(),this.updateButtonStates(),this.setSlideStep()}handleResize(){let e=document.documentElement.clientWidth;e!==this.windowWidth&&(this.resetSlider(),this.distance=this.updateWidthItem(),this.visibleSlides=this.getVisibleSlidesMediaQueries(this.mediaQueries),this.updateButtonStates(),this.setTotalSteps(),this.windowWidth=e,this.dispatchSlideChangeEvent(),this.callBackResize())}handleDOMLoaded(){this.updateButtonStates(),this.setTotalSteps(),this.dispatchSlideChangeEvent()}initDragDrop(e=!1){this.flagDragDropTouch=!0,this.isDragging=!1,this.touchStart=0,this.touchEnd=0,this.touchMove=0,this.ontouchstart=this.handleStart.bind(this),this.ontouchmove=this.handleMove.bind(this),this.ontouchend=this.handleEnd.bind(this),this.elemSliderTrack.addEventListener("touchstart",this.ontouchstart,{passive:!1}),this.elemSliderTrack.addEventListener("touchmove",this.ontouchmove,{passive:!1}),document.addEventListener("touchend",this.ontouchend),e&&(this.flagDragDropMouse=!0,this.onmousedown=this.handleStart.bind(this),this.onmousemove=this.handleMove.bind(this),this.onmouseup=this.handleEnd.bind(this),this.elemSliderTrack.addEventListener("mousedown",this.onmousedown,{passive:!1}),this.elemSliderTrack.addEventListener("mousemove",this.onmousemove,{passive:!1}),document.addEventListener("mouseup",this.onmouseup))}handleStart(e){e.preventDefault();const d=e.touches?e.touches[0].clientX:e.clientX;this.startDragDrop(d)}handleMove(e){if(!this.isDragging)return;e.preventDefault();const d=e.touches?e.touches[0].clientX:e.clientX;this.moveDragDrop(d)}handleEnd(){this.isDragging&&this.endDragDrop()}startDragDrop(e){this.isDragging=!0,this.touchStart=e}moveDragDrop(e){this.touchStart&&(this.touchMove=e-this.touchStart+this.position,this.animateSlider(this.elemSliderTrack,this.touchMove),this.touchEnd=e)}endDragDrop(){this.isDragging=!1,this.touchMove&&(this.position=this.touchMove,setTimeout(()=>{!this.touchEnd||!this.touchStart||(this.position>0?(this.animateSlider(this.elemSliderTrack,0),this.position=0,this.setSlideStep()):this.position<(this.sliderEnd()||0)?(this.animateSlider(this.elemSliderTrack,this.sliderEnd()||0),this.position=this.sliderEnd()||0,this.setSlideStep()):this.touchEnd-this.touchStart<-20?(this.position=this.distance*Math.floor(this.position/this.distance),this.setSlideStep(),this.animateSlider(this.elemSliderTrack,this.position)):this.touchEnd-this.touchStart>20?(this.position=this.distance*Math.ceil(this.position/this.distance),this.setSlideStep(),this.animateSlider(this.elemSliderTrack,this.position)):(this.position=this.distance*Math.round(this.position/this.distance),this.animateSlider(this.elemSliderTrack,this.position)),this.updateButtonStates())},100))}sliderEnd(){if(this.visibleSlides)return-(this.sliderLength*this.distance-this.visibleSlides*this.distance)}setTotalSteps(){this.visibleSlides&&(this.totalSteps=this.sliderLength-this.visibleSlides+1)}setSlideStep(){if(this.position>0)return;const e=Math.abs(this.position/this.distance)+1;this.stepNumber=e,this.dispatchSlideChangeEvent()}getVisibleSlidesMediaQueries(e){for(let d in e)if(e[d].matches)return parseInt(d)}updateWidthItem(){return this.elemItem.offsetWidth}updateButtonStates(){this.elemBtnNext&&(this.elemBtnNext.disabled=this.position<=(this.sliderEnd()||0)),this.elemBtnPrev&&(this.elemBtnPrev.disabled=this.position>=0)}moveNext(){if(!this.visibleSlides)return;const e=this.visibleSlides*this.distance-this.distance*this.sliderLength;this.position<=e||(this.position=this.position-this.distance,this.animateSlider(this.elemSliderTrack,this.position))}movePrev(){this.position!==0&&(this.position=this.position+this.distance,this.animateSlider(this.elemSliderTrack,this.position))}animateSlider(e,d){requestAnimationFrame(()=>{e.style.transform=`translateX(${d}px)`})}resetSlider(){this.stepNumber=1,this.position=0,this.animateSlider(this.elemSliderTrack,this.position)}}const ae={class:"slider__content"},le=["src"],de=X({__name:"SliderProduct",props:{images:{}},emits:["slider-move"],setup(c,{emit:e}){const d="/game3d/",E={1:window.matchMedia("(min-width: 1px)")},_=c,s=M(null),b=M(null),u=M([]);let l;const h=e;function i(a){h("slider-move",a)}function r(a){i({currentStep:a.detail.currentStep,totalSteps:a.detail.totalSteps})}return U(()=>{if(u.value&&s.value&&b.value){const a={btnNext:null,btnPrev:null,sliderTrack:b.value,itemLength:_.images.length,item:u.value[0]};l=new re(E),l.initSlider(a),l.initDragDrop(!0),s.value.addEventListener("slideChanged",r)}}),F(()=>{l&&l.removeAllListener()}),(a,L)=>(f(),k("div",{ref_key:"refSlider",ref:s,class:"slider"},[o("div",{ref_key:"refSliderTrack",ref:b,class:"slider__track"},[(f(!0),k($,null,V(_.images,g=>(f(),k("div",{ref_for:!0,ref_key:"refItem",ref:u,class:"slider__item"},[o("div",ae,[o("img",{src:`${d}images/${g}`,alt:"ps6"},null,8,le)])],512))),256))],512)],512))}}),ce=j(de,[["__scopeId","data-v-bc7ac67d"]]),he=(c,e,d,E,_=!1)=>{const s=E,b=e.length,u=e.split("");let l=e.split(""),h="",i=c,r=c,a=!1;s.addEventListener("focus",w),s.addEventListener("blur",B),s.addEventListener("keydown",x),s.addEventListener("click",N),_&&(s.addEventListener("mouseenter",g),s.addEventListener("mouseleave",T));function L(){s.removeEventListener("focus",w),s.removeEventListener("blur",B),s.removeEventListener("keydown",x),s.removeEventListener("click",N),_&&(s.removeEventListener("mouseenter",g),s.removeEventListener("mouseleave",T))}function g(t){h.length||(t.target.value=e)}function T(t){!h.length&&!a&&(t.target.value="")}function w(t){a=!0,h.length||(t.target.value=e,m(s,c))}function B(t){a=!1,h.length||(t.target.value="")}function x(t){t.preventDefault(),console.log(t);const v=t.key;if(v!=="Tab"){if(v==="Delete"&&r<i){if(r<c){r=c,m(t.target,r);return}(d.includes(l[i-1])||l[i-1]===" ")&&(i=p(i)),i=p(i),l=I(l,i,u),h=A(h),t.target.value=l.join(""),m(t.target,r);return}if(v==="ArrowRight"&&(r<b&&r++,m(t.target,r)),v==="ArrowLeft"&&(r>0&&r--,m(t.target,r)),v==="Backspace"&&i>c){if(d.includes(l[i-1])||l[i-1]===" "){i=p(i),i=p(i),l=C(l,i,u),r=i,setTimeout(()=>{t.target.value=l.join(""),m(t.target,r)},0),h=A(h);return}i=p(i),r=i,l=C(l,i,u),h=A(h),t.target.value=l.join(""),m(t.target,r);return}i!==b&&(t.code==="Backspace"&&t.target.selectionStart<c&&(t.preventDefault(),m(t.target,c)),v>="0"&&v<="9"&&((d.includes(l[i])||l[i]===" ")&&(i=D(i)),h+=t.key,l[i]=t.key,i=D(i),r=i,t.target.value=l.join(""),m(t.target,r)))}}function N(t){if(console.log(t),t.target.selectionStart<c||!h){m(t.target,c),r=t.target.selectionStart;return}r=t.target.selectionStart}function C(t,v,R){return t.map((z,S,P)=>S===v?(P[S]=R[S],P[S]):z)}function I(t,v,R){return t.map((z,S,P)=>S>=v&&P[S]!==" "&&!d.includes(P[S])?P[S]=R[S]:z)}function m(t,v){t.selectionStart=t.selectionEnd=v}function p(t){return t-1}function D(t){return t+1}function A(t){return t.slice(0,-1)}return L},ue={class:"detail-product x-center width-common"},me={class:"detail-product__header"},ve={class:"detail-product__title"},pe={class:"detail-product__price"},fe={class:"detail-product__slider"},_e={key:1,class:"detail-product__slider-step"},ge={key:2},Se={class:"detail-product__info"},ke={class:"detail-product__info-header"},be={class:"detail-product__tab-content"},Ee={class:"detail-product__description"},Le={class:"detail-product__tab-content"},De={class:"table-content"},Me={class:"table-content__name"},Pe={class:"table-content__value"},Te={class:"detail-product__order"},we={action:"/",method:"POST",class:"order-form"},Be={class:"order-form__group"},xe=X({__name:"PageProduct",setup(c){const e=ne(),E=J().params.id,_=M(),s=M(null),b=M(1),u=M("description");let l=null;const h=r=>{b.value=r.currentStep};function i(r,a){const L=a.find(g=>g.id===r);return L||null}return Y(async()=>{e.products||await e.fetchProducts(),typeof E=="string"&&e.products&&(s.value=i(E,e.products))}),U(async()=>{l=he(3,"+7(___)___-__-__",[")","(","-"],_.value,!0)}),F(()=>{l()}),(r,a)=>{var g,T,w,B,x,N,C,I,m;const L=te("RouterLink");return f(),k("section",ue,[Z(L,{class:"detail-product__link-back",to:"/products/?page=1"},{default:ee(()=>a[2]||(a[2]=[o("img",{src:oe,alt:"назад"},null,-1)])),_:1}),o("div",me,[o("h1",ve,y(((g=s.value)==null?void 0:g.name)||"нет названия"),1),o("div",pe,y((T=s.value)!=null&&T.price?((w=s.value)==null?void 0:w.price)+" р":"нет цены"),1)]),o("div",fe,[(x=(B=s.value)==null?void 0:B.images)!=null&&x.length?(f(),ie(ce,{key:0,onSliderMove:h,images:s.value.images},null,8,["images"])):se("",!0),(C=(N=s.value)==null?void 0:N.images)!=null&&C.length?(f(),k("div",_e,[(f(!0),k($,null,V(s.value.images,(p,D)=>(f(),k("div",{key:p,class:W(["step-icon",{"step-icon--active":D+1===b.value}])},null,2))),128))])):(f(),k("div",ge,"Загрузка изображений..."))]),o("div",Se,[o("div",ke,[o("button",{class:W(["detail-product__tab tab-button",{"detail-product__tab--active":u.value==="description"}]),onClick:a[0]||(a[0]=p=>u.value="description")}," Описание ",2),o("button",{class:W(["detail-product__tab tab-button",{"detail-product__tab--active":u.value==="specs"}]),onClick:a[1]||(a[1]=p=>u.value="specs")}," Спецификация ",2)]),O(o("div",be,[o("p",Ee,y((I=s.value)==null?void 0:I.description),1)],512),[[Q,u.value==="description"]]),O(o("div",Le,[o("table",De,[o("tbody",null,[(f(!0),k($,null,V((m=s.value)==null?void 0:m.specifications,(p,D)=>(f(),k("tr",{class:"table-content__row",key:D},[o("td",Me,y(D),1),o("td",Pe,y(p),1)]))),128))])])],512),[[Q,u.value==="specs"]])]),o("div",Te,[o("form",we,[a[4]||(a[4]=o("div",{class:"order-form__group"},[o("label",{for:"order-name",class:"order-form__label"},"Ваше имя"),o("input",{type:"text",id:"order-name",class:"order-form__input",placeholder:"Иван Иванов",required:""})],-1)),o("div",Be,[a[3]||(a[3]=o("label",{for:"order-phone",class:"order-form__label"},"Телефон",-1)),o("input",{ref_key:"refInputPhone",ref:_,type:"tel",id:"order-phone",autocomplete:"off",class:"order-form__input",pattern:"^\\+7\\(\\d{3}\\)\\d{3}-\\d{2}-\\d{2}$",placeholder:"+7(953)723-50-79",required:""},null,512)]),a[5]||(a[5]=o("button",{type:"submit",class:"order-form__submit"},"Заказать",-1))])])])}}}),Ie=j(xe,[["__scopeId","data-v-33f1949e"]]);export{Ie as default};
